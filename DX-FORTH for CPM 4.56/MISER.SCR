\ Miser's Case                                                                                                                  Extend CASE with Pascal and C style features                                                                                    COND OF ELSE CONT (in DX-Forth kernel)                          COND EQUAL RANGE WHEN                                           CONTINUE                                                        IF                                                                                                                              See demo screen for usage                                                                                                                                                                                                                                                                                                                                                                                                                                       \ Miser's Case                                                  forth definitions decimal                                                                                                       cr ." loading Miser's Case "   2 5 thru                         \   ." loading Case demo "      6   load                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ Miser's Case                                                  application                                                                                                                     checking off                                                                                                                    code (equ)                                                        d pop  h pop  cmpu call  bran jz  here ( *)                     h push  b inx  b inx  next  end-code                                                                                          code (rng)                                                        h pop  d pop  dsub call  xthl  1 $ shld  dsub call              d pop  cmpu call  bran jz  bran jc  1 $ lhld  ( *) jmp          1 $:  0 ,  end-code                                                                                                           checking on                                                                                                                     \ Miser's Case                                                  system                                                          \ Wil Baden's COND THENS  (now in DX-FORTH kernel)              \ : COND                                                        \  cs-mark ; immediate                                                                                                          \ : CONT ( was THENS )                                          \  begin  cs-test while  postpone then  repeat cs-drop ;        \  immediate                                                                                                                    \ Add Pascal-like features                                      : EQUAL                                                           postpone (equ) >mark ; immediate                                                                                              : RANGE                                                           postpone (rng) >mark ; immediate                              \ Miser's Case                                                  : WHEN                                                            postpone else  cs-push  postpone cont  cs-pop ; immediate                                                                     \ Add C Switch flow-through                                     : CONTINUE                                                        cs-push  postpone cont  postpone cond  cs-pop ; immediate                                                                     application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \ Miser's Case                                                  behead (equ) (rng)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \ Case demo                                                     hex                                                             : test ( n )  space                                               cond  0  1F range                                                     7F    equal  when  ." Control char "       end            cond  20 2F range                                                     3A 40 range                                                     5B 60 range                                                     7B 7E range  when  ." Punctuation "        end            cond  30 39 range  when  ." Digit "              end            cond  41 5A range  when  ." Upper case letter "  end            cond  61 7A range  when  ." Lower case letter "  end            drop ." Not a character " ;                                   decimal                                                         -->                                                                                                                             \ Case demo                                                     cr cr ." [press any key] " key drop                             cr cr ." Miser's CASE demo ..." cr                                                                                              cr  char a  ."   " dup emit  test                               cr  char ,  ."   " dup emit  test                               cr  char 8  ."   " dup emit  test                               cr  char ?  ."   " dup emit  test                               cr  char K  ."   " dup emit  test                               cr  0              dup 3 .r  test                               cr  127            dup 3 .r  test                               cr  128            dup 3 .r  test                                                                                                                                                                                                                                                                                               