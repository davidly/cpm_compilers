\ Information                                                                                                                   NEWAPP is a skeletal program that allows users to quickly       develop a DOS application. It provides often needed tasks       including error handling, command-line parsing, file            operations, buffered I/O, help screen, number and string        functions.                                                                                                                      NEWAPP comprises two parts:                                                                                                       NEWAPP.SCR   skeletal application program                       DOSLIB.SCR   function support library                                                                                                                                                                                                                                                                                         \ Load - main screen                                            empty forth definitions decimal application                     warning on                                                                                                                      : TITLE ." NEWAPP ver 0.0  2024-05-10" cr ;                                                                                     cr ." Compiling: "  title  2 load                                                                                               cr ." Save to disk? "  y/n  [if]                                \  tally @  pad + #256 + limit s0 @ - +  set-limit                turnkey program NEWAPP                                        [then]                                                                                                                                                                                                                                                                                                                          \ Load - defaults                                               variable TALLY  0 tally !           \ run-time memory tally     defer ?STOP   ' noop is ?stop       \ user abort check          defer CON-IO  ' bios-io is con-io   \ default console i/o mode  defer ONERROR ' noop is onerror     \ reset on-error handler    defer ONSTART ' noop is onstart     \ startup initialization                                                                    blk @ 1+ #screens 1- thru       \ load electives & application                                                                   ' ?stopkey is ?stop            \ enable user abort             \ ' dos-io is con-io             \ enable console redirection   \ ' delout +is onerror           \ delete outfile on error      \ wrtchk off                     \ disable overwrite check                                                                                                                                                                                                      \ Electives                                                     1 fload DOSLIB  \ DOSLIB library                                 _Errors        \ error handler                                 \ _Inout1        \ number output                                \ _Inout2        \                                              \ _Compare1      \ basic compare                                 _String1       \ basic strings                                 \ _String2       \ extra strings                                 _Parse1        \ cmdline parsing                               \ _Parse2        \ cmdline extra                                 _Files         \ default files                                 \ _Bread         \ buffer read char                             \ _Bread2        \ buffer read data/text                        \ _Bwrite        \ buffer write char                            \ _Bwrite2       \ buffer write data/text                                                                                       \ Electives                                                     \ _Random        \ random numbers                               \ _Shuffle       \ shuffle cells                                \ _Qsort         \ quicksort cells                              \ _Dos1          \ fcb                                          \ _Disk          \ disk                                         \ _Timeconv      \ convert                                      \ _Timepack      \ packing                                      \ _Clock         \ clock                                        \ _Filematch     \ file find first/next                         \ _Wildexp       \ file wildcard expander                       \ _Fileattr      \ file attribute                                                                                                                                                                                                                                                                                               \ Electives                                                     \ _Env           \ environment                                  \ _Exec          \ exec prog/command                            \ _Video1        \ textcolor attrib cursor                      \ _Video2        \ mode page                                    \ _Timing1       \ timer                                        \ _Timing2       \ delay                                        \ _Timing3       \ timer0 mode                                  \ _Device1       \ 8087 cpu keybd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ Help screen - HELP                                            : HELP ( -- )  dos-io  cr cr title                                cr ." Use: NEWAPP [opt] file[.TXT] [file[.DOC]]" cr             cr ." -A   set A option"                                        cr ." -B   set B option"                                        cr ." -Cn  set C option using numeric argument (1-10)"          cr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \ Help screen - HELP                                              cr ." default: list program defaults here"                      cr                                                              cr ." Insert a brief description of program here."              cr ." The HELP screen should be invoked when a program"         cr ." is unable to proceed due to fatal user error."            con-io  abort ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ Variables                                                     variable A-VAR                  \                               variable B-VAR                  \                               integer C-VAL  1 to c-val       \                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ SETOPT                                                        \ Set switch                                                    :noname ( a u char -- a' u' )                                     upcase                                                          [char] A  of  A-VAR on   end                                    [char] B  of  B-VAR off  end                                    [char] C  of  /num 1 10 ?rng to C-VAL  end                      .bad ;  is setopt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ PARSEFN                                                       \ Parse filenames:  file[.AAA] [file[.BBB]]                     :noname ( -- )                                                    argv 0= if  help  then                                          s" TXT" +ext  ifile !fname                                      argv 0= if  ifile @fname  -path -ext  then                      s" DOC" +ext  ofile !fname ;  is parsefn                                                                                      \\ Parse filenames:  file[.AAA] [file[.BBB]][.ext]              :noname ( -- )                                                    argv 0= if  help  then                                          s" AAA" +ext  2dup ifile !fname  -path -ext                     argv if  2dup -ext nip  while  2nip  then                       s" BBB"  else  1 /string  then  +ext                            ofile !fname ;  is parsefn                                                                                                    \ OPENFILES                                                     : OPENFILES ( -- )                                                cr ." i: " .ifile  r/o openin                                   cr ." o: " .ofile  r/w makeout                                  cr                                                            ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ (RUN)                                                         \ Run application                                               : (RUN) ( -- )                                                    openfiles                                                       ( perform the application tasks )                               begin  pad 64 read  dup while  write  repeat 2drop              closefiles                                                    ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ DEFAULTS                                                      \ Set application defaults                                      : DEFAULTS ( -- )                                               ;                                                                                                                               defaults                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ RUN PROGRAM                                                   \ Run application with error handling                           : RUN ( -- )                                                      ['] (run) catch ?dup if  >r onerror r> throw  then ;                                                                          \ Main                                                          : PROGRAM ( -- )                                                  onstart           \ startup initialization                      con-io            \ default console mode                        defaults          \ set defaults                                cr title          \ show application name                       cmdtail parsecmd  \ process command-line                        run               \ run application                             cr ." done"       \ show success                              ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               