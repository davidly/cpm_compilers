;
;	DOODLE.ASM
;	1/22/85 Les
;	Echos all inputs to CRT
;
BDOS	EQU	0005H
;
	ORG	100H
;
START:	LXI	H,0000H
	DAD	SP
	SHLD	OLDSTAK ; Save old stack
	LXI	SP,STACK
	JMP	BEGIN
;
EXIT:	LHLD	OLDSTAK
	SPHL
	RET
;
BEGIN:	CALL	CRTTST	; Get character
	CALL	CRTOUT	; Echo to CRT
	JMP	BEGIN	; Loop
;
CRTTST: MVI	C,06H
	MVI	E,0FFH
	CALL	BDOS
	CPI	1BH
	RNZ
	MVI	C,06H
	MVI	E,0FFH
	CALL	BDOS
	CPI	'%'	; Shift RED function key
	JZ	EXIT	; Exit program
	CPI	0A7H	; Shift WHITE function key
	JZ	ALTCHR
	PUSH	PSW
	MVI	A,01BH
	CALL	CRTOUT
	POP	PSW
	CALL	CRTOUT	; Echo character if no match
	RET
;
ALTCHR: LDA	ALTMOD
	CPI	00H
	JNZ	$+8
	XRA	A
	STA	ALTMOD
	RET
	MVI	A,80H
	STA	ALTMOD
	RET
;
CRTOUT: MVI	C,06H
	MOV	E,A
	LDA	ALTMOD
	ORA	E
	MOV	E,A
	CALL	BDOS
	RET
;
OLDSTAK DS	064H
STACK	DS	01H
ALTMOD	DB	00H
;
	END	START
6H
	MOV	E,A
	LDA	ALTMOD
	ORA	E
	M